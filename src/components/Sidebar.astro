---
const { selectedItem } = Astro.props;
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import LanguagePicker from "./LanguagePicker.astro";
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
import { getRelativeLocaleUrl } from "astro:i18n";

function handleTarget(href: string) {
  return getRelativeLocaleUrl(lang, href);
}
---

<aside
  data-animation="default"
  data-collapse="medium"
  data-duration="400"
  data-easing="ease"
  data-easing2="ease"
  role="banner"
  class="sidebar w-nav"
>
  <div class="nav-content">
    <a href={handleTarget("/")} class="w-nav-brand" aria-label="home">
      <div class="niv-data">
        <img
          src="/puertofolio/assets/ja.svg"
          loading="eager"
          alt="Profile picture"
          class="niv-image"
        />
        <div>
          <div class="label-white">{t("title")}</div>
          <div class="label-gray">{t("engineer")}</div>
        </div>
      </div>
    </a>

    <nav role="navigation" class="w-nav-menu">
      <a
        href={handleTarget("/")}
        class={`nav-link-container w-inline-block ${
          selectedItem === "home" ? "w--current" : ""
        }`}
      >
        <img
          src="/puertofolio/assets/home.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>{t("nav.home")}</div>
      </a>
      <a
        href={handleTarget("/experience")}
        class={`nav-link-container w-inline-block ${
          selectedItem === "experience" ? "w--current" : ""
        }`}
        aria-current={selectedItem === "experience" ? "page" : undefined}
      >
        <img
          src="/puertofolio/assets/code.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>{t("nav.experience")}</div>
      </a>
      <a
        href={handleTarget("/personal-projects")}
        class={`nav-link-container w-inline-block ${
          selectedItem === "personal-projects" ? "w--current" : ""
        }`}
      >
        <img
          src="/puertofolio/assets/favorite.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>{t("nav.personalProjects")}</div>
      </a>
      <a
        href={handleTarget("/skills")}
        class={`nav-link-container w-inline-block ${
          selectedItem === "skills" ? "w--current" : ""
        }`}
      >
        <img
          src="/puertofolio/assets/hammer.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>{t("nav.skills")}</div>
      </a>
      <a
        href={handleTarget("/ai")}
        class={`nav-link-container w-inline-block ${
          selectedItem === "ai" ? "w--current" : ""
        }`}
      >
        <img
          src="/puertofolio/assets/ai.svg"
          loading="eager"
          alt=""
          class="nav-link-image"
        />
        <div>{t("nav.ai")}</div>
      </a>
    </nav>

    <div
      class="navbar-icon-button w-nav-button"
      style="-webkit-user-select: text;"
      aria-label="menu"
      role="button"
      tabindex="0"
    >
      <img
        src="/puertofolio/assets/menu.svg"
        loading="eager"
        alt=""
        class="navbar-icon"
      />
    </div>
    <LanguagePicker />
  </div>

  <script>
    import { setupNav } from "../scripts/nav.js";

    let cleanup;
    document.addEventListener("astro:page-load", () => {
      if (cleanup) cleanup();
      cleanup = setupNav();
    });

    document.addEventListener("astro:before-swap", () => {
      if (cleanup) cleanup();
    });
  </script>
</aside>
